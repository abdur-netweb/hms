<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Dashboard</title>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/responsive.css" rel="stylesheet" />
</head>

<body>
  <section class="book_section layout_padding">
    <div class="container">
      <h2 id="roleDisplay" class="text-center"></h2>
      
      <!-- Admin Dashboard -->
      <div id="adminDashboard" class="hidden">
        <h4>Admin Panel</h4>
        <button class="btn btn-primary" onclick="addDoctor()">Add Doctor</button>
        <button class="btn btn-secondary" onclick="listDoctors()">View Doctors</button>
        <button class="btn btn-info" onclick="listPatients()">View Patients</button>
      </div>

      <!-- Doctor Dashboard -->
      <div id="doctorDashboard" class="hidden">
        <h4>Doctor Panel</h4>
        <button class="btn btn-success" onclick="viewAppointments()">View Appointments</button>
      </div>

      <!-- Patient Dashboard -->
      <div id="patientDashboard" class="hidden">
        <h4>Book an Appointment</h4>
        <form>
          <div class="form-row">
            <div class="form-group col-lg-6">
              <label for="doctorList">Doctor's Name</label>
              <select class="form-control" id="doctorList"></select>
            </div>
            <div class="form-group col-lg-6">
              <label for="appointmentDate">Choose Date</label>
              <input type="date" class="form-control" id="appointmentDate">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-lg-6">
              <label for="timeSlot">Time Slots</label>
              <select class="form-control" id="timeSlot">
                <option>10:00 AM - 11:00 AM</option>
                <option>01:00 PM - 02:00 PM</option>
                <option>04:00 PM - 05:00 PM</option>
              </select>
            </div>
            <div class="form-group col-lg-6">
              <label for="symptoms">Symptoms</label>
              <input type="text" class="form-control" id="symptoms" placeholder="Describe your symptoms">
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Book Now</button>
        </form>
      </div>

      <button id="logoutBtn" class="btn btn-danger mt-4">Logout</button>
    </div>
  </section>

  <script>
    fetch("http://127.0.0.1:5000/dashboard", { method: "GET", credentials: "include" })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          window.location.href = "login.html";
        } else {
          let role = data.message.replace("Welcome ", "");
          document.getElementById("roleDisplay").innerText = `Logged in as: ${role}`;
          showDashboard(role);
        }
      })
      .catch(error => console.error("Error:", error));

    function showDashboard(role) {
      if (role.includes("Admin")) {
        document.getElementById("adminDashboard").classList.remove("hidden");
      } else if (role.includes("Doctor")) {
        document.getElementById("doctorDashboard").classList.remove("hidden");
      } else if (role.includes("Patient")) {
        document.getElementById("patientDashboard").classList.remove("hidden");
        loadDoctorDropdown();
      }
    }

    function loadDoctorDropdown() {
      fetch("http://127.0.0.1:5000/admin/doctors")
        .then(response => response.json())
        .then(doctors => {
          const dropdown = document.getElementById("doctorList");
          doctors.forEach(doc => {
            let option = document.createElement("option");
            option.value = doc.id;
            option.textContent = doc.name;
            dropdown.appendChild(option);
          });
        });
    }

    document.getElementById("logoutBtn").addEventListener("click", function () {
      fetch("http://127.0.0.1:5000/logout", { method: "POST", credentials: "include" })
        .then(response => response.json())
        .then(data => {
          alert(data.message);
          window.location.href = "login.html";
        });
    });
  </script>
</body>
</html>
